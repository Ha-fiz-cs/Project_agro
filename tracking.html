<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Agri Link • Tracking</title>
<style>
:root { --bg:#0f172a; --panel:#111827; --muted:#94a3b8; --text:#e5e7eb; --accent:#22c55e; --accent-2:#06b6d4; }
* { box-sizing:border-box; }
body { margin:0; font-family:system-ui, sans-serif; background:linear-gradient(135deg,#0b1220,#0f172a 60%,#0b1220); color:var(--text); }
header { position:sticky; top:0; backdrop-filter:blur(8px); background:rgba(2,6,23,.6); border-bottom:1px solid rgba(148,163,184,.15); z-index:10; }
.nav { display:flex; align-items:center; justify-content:space-between; max-width:1200px; margin:0 auto; padding:14px 20px; }
.brand { display:flex; gap:10px; align-items:center; font-weight:700; }
.brand .logo { width:34px; height:34px; border-radius:10px; background:linear-gradient(135deg,var(--accent),var(--accent-2)); display:grid; place-items:center; color:#041b11; font-weight:900; }
.links { display:flex; gap:10px; flex-wrap:wrap; }
.link { color:var(--text); text-decoration:none; border:1px solid rgba(148,163,184,.18); padding:8px 12px; border-radius:10px; background:rgba(17,24,39,.6); font-size:14px; }
.link.active { background:linear-gradient(180deg,rgba(34,197,94,.15),rgba(6,182,212,.12)); border-color:rgba(34,197,94,.35); }
main { max-width:900px; margin:30px auto; padding:0 20px 40px; display:grid; gap:20px; }
.panel { background:rgba(2,6,23,.5); border:1px solid rgba(148,163,184,.15); border-radius:16px; padding:20px; }
select,input { background:rgba(3,7,18,.7); border:1px solid rgba(148,163,184,.18); color:var(--text); padding:10px 12px; border-radius:10px; width:100%; font:inherit; }
.timeline { display:grid; gap:20px; margin-top:20px; position:relative; }
.step { display:flex; align-items:center; gap:12px; }
.step::before { content:''; width:14px; height:14px; border-radius:50%; flex-shrink:0; }
.step.done::before { background:var(--accent); box-shadow:0 0 6px var(--accent); }
.step.current::before { background:var(--accent-2); box-shadow:0 0 8px var(--accent-2); }
.step.pending::before { background:#1e293b; border:2px solid #334155; }
.step span { font-size:15px; }
.notice { background:rgba(34,197,94,.12); border:1px solid rgba(34,197,94,.35); color:#b6f2cf; padding:10px; border-radius:10px; font-size:13px; }
</style>
<script>
const db = {
  matches: JSON.parse(localStorage.getItem('agro_matches') || '[]'),
  farmers: JSON.parse(localStorage.getItem('agro_farmers') || '[]'),
  consumers: JSON.parse(localStorage.getItem('agro_consumers') || '[]')
};
window.addEventListener('DOMContentLoaded', ()=>{
  const select = document.querySelector('#match-select');
  db.matches.forEach(m=>{
    const lot = db.farmers.find(x=>x.id===m.lotId)||{};
    const req = db.consumers.find(x=>x.id===m.reqId)||{};
    const opt = document.createElement('option');
    opt.value = m.id;
    opt.textContent = `${lot.product||'Lot'} (${lot.category||''}) → ${req.location||'Consumer'}`;
    select.appendChild(opt);
  });
  select.addEventListener('change', ()=>showTimeline(select.value));
});
function showTimeline(id){
  const timeline = document.querySelector('#timeline');
  const m = db.matches.find(x=>x.id===id);
  if(!m){ timeline.innerHTML='<div class="notice">No data available.</div>'; return; }
  const steps = ["Supply Added / Need Requested","Match Found","Collection & Quality Confirmed","Dispatched","Delivered"];
  const events = m.timeline?.map(e=>e.e)||[];
  let html = '';
  steps.forEach((s,i)=>{
    let cls = 'pending';
    if(events[i]) cls = 'done';
    else if(events.length===i) cls = 'current';
    html += `<div class="step ${cls}"><span>${s}</span></div>`;
  });
  timeline.innerHTML = html;
}
</script>
</head>
<body>
<header>
  <div class="nav">
    <div class="brand"><div class="logo">Ag</div><div>AgroMatch</div></div>
    <nav class="links">
      <a class="link" href="farmer.html">Farmer</a>
      <a class="link" href="consumer.html">Consumer</a>
      <a class="link" href="logistics.html">Logistics</a>
      <a class="link" href="track.html" class="active">Tracking</a>
    </nav>
  </div>
</header>
<main>
  <section class="panel">
    <h2>Track Order / Match</h2>
    <p class="muted">Select a match or supply to view its real-time progress.</p>
    <select id="match-select"><option value="">Select Match</option></select>
    <div id="timeline" class="timeline"></div>
  </section>
</main>
</body>
</html>
